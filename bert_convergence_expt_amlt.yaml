description: Testing the job sumbmission via amlt

target:
  service: amlk8s
  # run "amlt target list amlk8s" to list the names of available AMLK8s targets
  name: itpeusp40cl
  vc: resrchvc

environment:
  image: tensorflow/tensorflow:latest-gpu
  registry: docker.io # any public registry can be specified here
  setup:
    - bash experiment_setup.sh


code:
  # local directory of the code. this will be uploaded to the server.
  # $CONFIG_DIR is expanded to the directory of this config file
  local_dir: $CONFIG_DIR/

data:
  # You need to run "python src/download_data.py" beforehand
  # to generate the dataset to be uploaded
  # don't forget to run with --upload-data
  # local_dir: $CONFIG_DIR/data/

  # The data will be uploaded to your default storage.
  #   Check ``multi_storage.yaml'' for more flexibility.
  remote_dir: dataset/multinli_1.0/



# Training all the configuration as hyperparam sweep
search:
  job_template:
    name: search_{experiment_name:s}_{auto:3s}
    sku: G1
    command:
    - python transformer_debugger.py -expt_num "pt.rel.model_type({model_type}).neg1_fmethod({neg1_flip_method}).lt({loss_type}).dropout_rate({dropout_rate}).l2({l2_lambd}).noise({noise}).hlayer({hlayer}).sample({sample}).epoch({epoch}).pval({pval}).rnum({run_num})" -num_sample {sample} -num_topics 1 -num_epochs {epoch} -path $$AMLT_DATA_DIR  -out_path $$AMLT_DATA_DIR -emb_path "glove-wiki-gigaword-100" -noise_ratio {noise} -num_hidden_layer {hlayer} -stage 2 -main_model_mode {main_mode} --normalize_emb -lr 5e-5 -head_retrain_mode {hretrain} -l2_lambd {l2_lambd} -loss_type {loss_type} -dropout_rate {dropout_rate} -dtype "nlp_bert" --bert_as_encoder --train_bert -neg_topic_corr {pval} -transformer {model_type} -neg1_flip_method {neg1_flip_method} --measure_flip_pdelta -run_num {run_num}
  type: grid
  max_trials: 100000
  params:
    - name: run_num
      values: [1,2,3]
    - name: model_type
      values: ["bert-base-uncased"]
    - name: neg1_flip_method
      values: ["remove_negation"]
    - name: loss_type
      values: ["x_entropy"]
    - name: dropout_rate
      values: ["0.0"]
    - name: l2_lambd
      values: ["0.0"]
    - name: hretrain
      values: ["no_warm_encoder"]
    - name: main_mode
      values: ["non_causal"]
    - name: noise
      values: [0.0]
    - name: hlayer
      values: [0]
    - name: sample
      values: [20000,16000,12000,8000,4000,400]
    - name: epoch
      values: [3]
    - name: pval
      values: [0.5]


