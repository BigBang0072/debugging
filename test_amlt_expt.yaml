description: Testing the job sumbmission via amlt

target:
  service: amlk8s
  # run "amlt target list amlk8s" to list the names of available AMLK8s targets
  name: itpeusp40cl
  vc: resrchvc

environment:
  image: tensorflow/tensorflow:2.3-gpu
  registry: docker.io # any public registry can be specified here
  setup:
    - . experiment_setup.sh

code:
  # local directory of the code. this will be uploaded to the server.
  # $CONFIG_DIR is expanded to the directory of this config file
  local_dir: $CONFIG_DIR/

data:
  # You need to run "python src/download_data.py" beforehand
  # to generate the dataset to be uploaded
  # don't forget to run with --upload-data
  # local_dir: $CONFIG_DIR/data/

  # The data will be uploaded to your default storage.
  #   Check ``multi_storage.yaml'' for more flexibility.
  # remote_dir: dataset/

# Training all the configuration as hyperparam sweep
search:
  job_template:
    name: search_{experiment_name:s}_{auto:3s}
    sku: G1
    command:
    - python transformer_debugger.py -expt_num "pt.rel.model_type({model_type}).lt({loss_type}).dropout_rate({dropout_rate}).l2({l2_lambd}).hretrain({hretrain}).main_mode({main_mode}).noise({noise}).hlayer({hlayer}).sample({sample}).epoch({epoch}).pval({pval}).rnum({rnum})" -num_sample {sample} -num_topics 1 -num_epochs {epoch} -path "dataset/multinli_1.0/" -emb_path "glove-wiki-gigaword-100" -noise_ratio {noise} -num_hidden_layer {hlayer} -stage 2 -main_model_mode {main_mode} --normalize_emb -lr 5e-5 -head_retrain_mode {hretrain} -l2_lambd {l2_lambd} -loss_type {loss_type} -dropout_rate {dropout_rate} -dtype "nlp_bert" --bert_as_encoder --train_bert -neg_topic_corr {pval} -transformer {model_type} -neg1_flip_method "dont_measure" --measure_flip_pdelta
  type: grid
  max_trials: 4
  params:
    - name: model_type
      values: ["bert-base-uncased"]
    - name: loss_type
      values: ["x_entropy"]
    - name: dropout_rate
      values: ["0.0"]
    - name: l2_lambd
      values: ["0.0"]
    - name: hretrain
      values: ["no_warm_encoder"]
    - name: main_mode
      values: ["non_causal"]
    - name: noise
      values: ["0.0"]
    - name: hlayer
      values: ["0"]
    - name: sample
      values: [10000]
    - name: epoch
      values: [3]
    - name: pval
      values: [0.5,0.6,0.7,0.8,0.9,0.99]
    - name: rnum
      values: [0]


